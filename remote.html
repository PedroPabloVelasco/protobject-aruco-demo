<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Remote â€” Control tÃ¡ctil</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Ubuntu,sans-serif;margin:0;background:#0f1115;color:#e5e7eb}
  h1{margin:16px;text-align:center;font-size:clamp(18px,5vw,24px)}
  .wrap{max-width:720px;margin:0 auto;padding:0 12px 24px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  button{appearance:none;border:1px solid #30364a;background:#1f2430;color:#e5e7eb;border-radius:16px;padding:14px;cursor:pointer;font-size:16px}
  button:active{transform:translateY(1px);filter:brightness(1.05)}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .badge{background:#232738;border:1px solid #30364a;padding:2px 8px;border-radius:999px;font-size:12px;color:#aab0be}
  .status{margin-top:12px;font-size:13px;color:#aab0be}
</style>
</head>
<body>
  <h1>Control tÃ¡ctil del cruce</h1>
  <div class="wrap">
    <div class="row">
      <span class="badge">Eventos (no snapshot)</span>
      <span class="badge">Enlaza con index.html</span>
    </div>

    <h3>NS</h3>
    <div class="grid">
      <button data-add="auto" data-dir="NS">âž• ðŸš— Auto â€” NS</button>
      <button data-rem="auto" data-dir="NS">âž– ðŸš— Auto â€” NS</button>
      <button data-add="bus" data-dir="NS">âž• ðŸšŒ Bus â€” NS</button>
      <button data-rem="bus" data-dir="NS">âž– ðŸšŒ Bus â€” NS</button>
      <button data-add="bici" data-dir="NS">âž• ðŸš² Bici â€” NS</button>
      <button data-rem="bici" data-dir="NS">âž– ðŸš² Bici â€” NS</button>
      <button data-add="ambulancia" data-dir="NS">âž• ðŸš‘ Ambulancia â€” NS</button>
      <button data-rem="ambulancia" data-dir="NS">âž– ðŸš‘ Ambulancia â€” NS</button>
    </div>

    <h3 style="margin-top:14px">EW</h3>
    <div class="grid">
      <button data-add="auto" data-dir="EW">âž• ðŸš— Auto â€” EW</button>
      <button data-rem="auto" data-dir="EW">âž– ðŸš— Auto â€” EW</button>
      <button data-add="bus" data-dir="EW">âž• ðŸšŒ Bus â€” EW</button>
      <button data-rem="bus" data-dir="EW">âž– ðŸšŒ Bus â€” EW</button>
      <button data-add="bici" data-dir="EW">âž• ðŸš² Bici â€” EW</button>
      <button data-rem="bici" data-dir="EW">âž– ðŸš² Bici â€” EW</button>
      <button data-add="ambulancia" data-dir="EW">âž• ðŸš‘ Ambulancia â€” EW</button>
      <button data-rem="ambulancia" data-dir="EW">âž– ðŸš‘ Ambulancia â€” EW</button>
    </div>

    <h3 style="margin-top:14px">PeatÃ³n</h3>
    <div class="grid">
      <button id="btnPed">ðŸš¶ Solicitud de PeatÃ³n</button>
      <button id="btnClear">ðŸ§¹ Limpiar todo</button>
    </div>

    <div class="status" id="status">Estado: listo.</div>
  </div>

  <script src="https://app.protobject.com/framework/p.js"></script>
  <script src="config.js"></script>
  <script>
    // Receptor temprano (evita warning)
    Protobject.Core.onReceived(()=>{});

    const PC_PAGE="index.html", status=document.getElementById('status');
    let uid=0; const genId=(role,dir)=>`${role}-${dir}-${Date.now()}-${++uid}`;

    function send(evt){
      try{ Protobject.Core.send({evt}).to(PC_PAGE); status.textContent='Conectado âœ”'; }
      catch{ status.textContent='Abre index.html y pulsa Connect'; }
    }
    function add(role,dir){ send({type:'add', id:genId(role,dir), role, dir}); }
    function rem(role,dir){ send({type:'removeOne', role, dir}); }

    document.body.addEventListener('click',e=>{
      const b=e.target.closest('button'); if(!b) return;
      if (b.id==='btnClear'){ send({type:'clearAll'}); return; }
      if (b.id==='btnPed'){ try{ Protobject.Core.send({det:{"100":{role:'peaton',dir:null,y:0}},order:[100],reasons:['peaton']}).to(PC_PAGE);}catch{} return; }
      const roleA=b.dataset.add, roleR=b.dataset.rem, dir=b.dataset.dir;
      if (roleA) add(roleA,dir); if (roleR) rem(roleR,dir);
    });
  </script>
</body>
</html>
